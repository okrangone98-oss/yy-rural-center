<!-- ... 기존 상단 header / 로그인 카드 등은 그대로 두고 ... -->

<section>
  <div class="card">
    <h2>공지사항 관리</h2>
    <p style="font-size:0.85rem; color:#666; margin-bottom:8px;">
      아래 목록은 공지사항 스프레드시트와 연동된 내용입니다.
      실제 수정·추가는 오른쪽 상단 버튼으로 Google 스프레드시트를 열어 진행해 주세요.
    </p>
    <button
      class="btn btn-primary"
      style="margin-bottom:10px;"
      onclick="window.open('https://docs.google.com/spreadsheets/d/1Qb3...여기에_편집용_URL...', '_blank');"
    >
      공지사항 시트 열기 (편집)
    </button>

    <ul class="list" id="admin-notice-list">
      <li>불러오는 중입니다…</li>
    </ul>
  </div>
</section>

<script>
  // notice.html과 동일한 CSV URL 사용
  const ADMIN_NOTICE_CSV_URL =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vTO3geLtt5vZ-bOZiY4vb_Rd48xcQGJyZbmjXcHA1ZDnDmFQWAysgxvD-EumgkalVDlmRgdHfzqIVwf/pub?gid=1610639191&single=true&output=csv";

  function parseCSV(text){
    const rows=[];let row=[];let field="";let insideQuotes=false;
    for(let i=0;i<text.length;i++){
      const c=text[i];
      if(c === '"'){
        if(insideQuotes && text[i+1]==='"'){field+='"';i++;}else{insideQuotes=!insideQuotes;}
      }else if(c === "," && !insideQuotes){
        row.push(field);field="";
      }else if((c==="\n"||c==="\r") && !insideQuotes){
        if(field!==""||row.length>0){row.push(field);rows.push(row);row=[];field="";}
      }else{
        field+=c;
      }
    }
    if(field!==""||row.length>0){row.push(field);rows.push(row);}
    return rows;
  }

  async function loadAdminNotices(){
    const listEl = document.getElementById("admin-notice-list");
    if(!listEl) return;

    try{
      const res = await fetch(ADMIN_NOTICE_CSV_URL);
      const text = await res.text();
      const rows = parseCSV(text);
      if(!rows.length){
        listEl.innerHTML = "<li>등록된 공지사항이 없습니다.</li>";
        return;
      }

      const headers = rows[0].map(h=>h.trim());
      const dataRows = rows.slice(1);

      const colIndex = {
        type: headers.findIndex(h => h.includes("구분") || h.includes("분류") || h.toLowerCase().includes("type")),
        title: headers.findIndex(h => h.includes("제목") || h.toLowerCase().includes("title")),
        date: headers.findIndex(h => h.includes("날짜") || h.includes("등록일") || h.toLowerCase().includes("date"))
      };

      const notices = dataRows
        .filter(r => r[colIndex.title] && r[colIndex.title].trim() !== "")
        .map(r => ({
          type: colIndex.type >= 0 ? (r[colIndex.type] || "").trim() : "공지",
          title: (r[colIndex.title] || "").trim(),
          date: colIndex.date >= 0 ? (r[colIndex.date] || "").trim() : ""
        }));

      if(!notices.length){
        listEl.innerHTML = "<li>등록된 공지사항이 없습니다.</li>";
        return;
      }

      listEl.innerHTML = "";
      notices.forEach(n=>{
        const li = document.createElement("li");
        li.textContent = `[${n.type}] ${n.title} – ${n.date}`;
        listEl.appendChild(li);
      });
    }catch(err){
      console.error("관리자 공지 로딩 오류:", err);
      listEl.innerHTML = "<li>공지사항을 불러오지 못했습니다.</li>";
    }
  }

  document.addEventListener("DOMContentLoaded", loadAdminNotices);
</script>
