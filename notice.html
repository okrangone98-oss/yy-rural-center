<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>공지사항 | 양양군 농촌활성화지원센터</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family:"Noto Sans KR",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      line-height:1.6;
      color:#222;
      background:#f5f5f5;
    }
    a{text-decoration:none;color:inherit;}

    header{
      position:sticky;
      top:0;
      z-index:10;
      background:#ffffffcc;
      backdrop-filter:blur(8px);
      border-bottom:1px solid #e5e5e5;
    }
    .container{
      width:100%;
      max-width:1080px;
      margin:0 auto;
      padding:0 16px;
    }
    .nav{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 0;
    }
    .logo{font-weight:700;font-size:1.1rem;}
    .logo span{color:#0b7c5b;}
    .nav-links{display:flex;gap:16px;font-size:0.95rem;}
    .nav-links a{padding:4px 8px;border-radius:999px;}
    .nav-links a:hover{background:#0b7c5b;color:#fff;}

    main{padding:48px 0;}
    .page-title{font-size:1.8rem;font-weight:700;margin-bottom:8px;}
    .page-sub{font-size:0.95rem;color:#555;margin-bottom:24px;}

    .notice-wrapper{
      background:#fff;
      border-radius:16px;
      border:1px solid #e5e5e5;
      padding:16px 18px;
      box-shadow:0 6px 18px rgba(0,0,0,0.03);
    }
    .notice-table{width:100%;border-collapse:collapse;font-size:0.9rem;table-layout:fixed;}
    .notice-table thead{background:#f5f7f6;}
    .notice-table th,
    .notice-table td{
      padding:10px 8px;
      border-bottom:1px solid #ececec;
      text-align:left;
    }
    .notice-table th:nth-child(2),
    .notice-table td:nth-child(2){
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .notice-table th:nth-child(3),
    .notice-table td:nth-child(3){
      text-align:right;
    }

    .notice-row{cursor:pointer;}
    .notice-row:hover{background:#f4fbf7;}

    .notice-type{
      font-size:0.8rem;
      color:#0b7c5b;
      font-weight:600;
      white-space:nowrap;
    }
    .notice-title{color:#222;}
    .notice-date{
      font-size:0.8rem;
      color:#777;
      white-space:nowrap;
    }
    .notice-empty{
      text-align:center;
      color:#888;
      padding:18px 0;
    }

    footer{
      padding:16px 0 24px;
      background:#111;
      color:#aaa;
      font-size:0.8rem;
      margin-top:40px;
    }
    footer .container{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    footer a{color:#e0f2e9;}

    /* ===== 모달 디자인 ===== */
    .modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index:2000;
    }
    .modal.is-open{display:flex;}
    .modal-overlay{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,0.45);
      backdrop-filter:blur(2px);
    }
    .modal-dialog{
      position:relative;
      background:#fff;
      border-radius:18px;
      padding:18px 20px 22px;
      width:min(720px,96vw);
      max-height:90vh;
      box-shadow:0 18px 45px rgba(0,0,0,0.25);
      z-index:1;
      display:flex;
      flex-direction:column;
      gap:10px;
      font-size:0.9rem;
    }
    .modal-title{
      font-size:1.1rem;
      font-weight:700;
      margin-bottom:4px;
    }
    .modal-meta{
      font-size:0.8rem;
      color:#777;
      margin-bottom:8px;
    }
    .modal-body{
      flex:1;
      overflow-y:auto;
      padding-right:4px;
      font-size:0.88rem;
      white-space:pre-wrap;
      line-height:1.6;
    }
    .modal-close{
      position:absolute;
      top:10px;
      right:10px;
      border:none;
      background:#f5f5f5;
      width:30px;
      height:30px;
      border-radius:999px;
      cursor:pointer;
      font-size:18px;
      line-height:1;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#666;
    }
    .modal-close:hover{background:#e2e2e2;}

    .modal-link{
      margin-top:10px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:8px 14px;
      border-radius:999px;
      background:#0b7c5b;
      color:#fff;
      font-size:0.85rem;
      font-weight:600;
    }
    .modal-link:hover{background:#096149;}

    @media (max-width:768px){
      .nav-links{display:none;}
      main{padding:32px 0;}
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="logo">
        양양군 <span>농촌활성화지원센터</span>
      </div>
      <nav class="nav-links">
        <a href="index.html#about">센터소개</a>
        <a href="index.html#programs">주요사업</a>
        <a href="index.html#teachers">강사진</a>
        <a href="notice.html">공지사항</a>
        <a href="index.html#gallery">활동사진</a>
        <a href="index.html#contact">오시는길</a>
        <a href="qna.html">Q&A</a>
        <a href="admin.html">관리자</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="container">
      <h1 class="page-title">공지사항</h1>
      <p class="page-sub">
        센터의 주요 공지, 모집 안내, 일정 변경 등의 내용을 한 눈에 보실 수 있습니다.
        각 행을 클릭하면 상세 내용을 확인하실 수 있습니다.
      </p>

      <div class="notice-wrapper">
        <table class="notice-table">
          <thead>
            <tr>
              <th style="width:80px;">구분</th>
              <th>제목</th>
              <th style="width:120px;">날짜</th>
            </tr>
          </thead>
          <tbody id="notice-tbody">
            <!-- JS로 전체 공지가 채워집니다 -->
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <div>© <span id="year"></span> 양양군 농촌활성화지원센터. All rights reserved.</div>
    </div>
  </footer>

  <!-- ===== 공지 상세 모달 ===== -->
  <div id="noticeModal" class="modal" aria-hidden="true">
    <div class="modal-overlay"></div>
    <div class="modal-dialog">
      <button type="button" class="modal-close" id="modal-close-btn">×</button>
      <div class="modal-title" id="modal-title"></div>
      <div class="modal-meta">
        <span id="modal-type"></span> · <span id="modal-date"></span>
      </div>
      <div class="modal-body" id="modal-content"></div>
      <a id="modal-link" class="modal-link" href="#" target="_blank" rel="noopener noreferrer">
        자세히 보기 / 관련 링크 열기
      </a>
    </div>
  </div>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // ✅ 공지 스프레드시트 CSV URL
    const NOTICE_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vTO3geLtt5vZ-bOZiY4vb_Rd48xcQGJyZbmjXcHA1ZDnDmFQWAysgxvD-EumgkalVDlmRgdHfzqIVwf/pub?gid=1610639191&single=true&output=csv";

    let NOTICES = [];

    // 공통 CSV 파서
    function parseCSV(text){
      const rows=[];let row=[];let field="";let insideQuotes=false;
      for(let i=0;i<text.length;i++){
        const c=text[i];
        if(c === '"'){
          if(insideQuotes && text[i+1]==='"'){field+='"';i++;}
          else{insideQuotes=!insideQuotes;}
        }else if(c === "," && !insideQuotes){
          row.push(field);field="";
        }else if((c==="\n"||c==="\r") && !insideQuotes){
          if(field!==""||row.length>0){row.push(field);rows.push(row);row=[];field="";}
        }else{
          field+=c;
        }
      }
      if(field!==""||row.length>0){row.push(field);rows.push(row);}
      return rows;
    }

    // 공지 불러오기
    async function loadNotices(){
      try{
        const res = await fetch(NOTICE_CSV_URL);
        const text = await res.text();
        const rows = parseCSV(text);
        if(!rows.length) return;

        const headers = rows[0].map(h=>h.trim());
        const dataRows = rows.slice(1);

        const colIndex = {
          type: headers.findIndex(h => h.includes("구분") || h.includes("분류") || h.toLowerCase().includes("type")),
          title: headers.findIndex(h => h.includes("제목") || h.toLowerCase().includes("title")),
          date: headers.findIndex(h => h.includes("날짜") || h.includes("등록일") || h.toLowerCase().includes("date")),
          url:  headers.findIndex(h => h.toLowerCase().includes("url") || h.includes("링크")),
          content: headers.findIndex(h => h.includes("내용") || h.toLowerCase().includes("content") || h.toLowerCase().includes("body"))
        };

        NOTICES = dataRows
          .filter(r => r[colIndex.title] && r[colIndex.title].trim() !== "")
          .map(r => ({
            type: colIndex.type >= 0 ? (r[colIndex.type] || "").trim() : "공지",
            title: (r[colIndex.title] || "").trim(),
            date: colIndex.date >= 0 ? (r[colIndex.date] || "").trim() : "",
            url:  colIndex.url  >= 0 ? (r[colIndex.url]   || "").trim() : "",
            content: colIndex.content >= 0 ? (r[colIndex.content] || "").trim() : ""
          }));

        renderNoticeTable(NOTICES);
      }catch(err){
        console.error("공지사항 로딩 오류:", err);
        const tbody = document.getElementById("notice-tbody");
        tbody.innerHTML = `
          <tr><td colspan="3" class="notice-empty">
            공지사항을 불러오지 못했습니다. 잠시 후 다시 시도해 주세요.
          </td></tr>
        `;
      }
    }

    // 테이블 렌더링
    function renderNoticeTable(list){
      const tbody = document.getElementById("notice-tbody");
      if(!tbody) return;

      if(!list.length){
        tbody.innerHTML = `
          <tr><td colspan="3" class="notice-empty">
            등록된 공지사항이 없습니다.
          </td></tr>
        `;
        return;
      }

      tbody.innerHTML = "";
      list.forEach((n, idx)=>{
        const tr = document.createElement("tr");
        tr.className = "notice-row";
        tr.dataset.index = idx;          // ✅ 나중에 모달에서 사용할 인덱스 저장

        tr.innerHTML = `
          <td class="notice-type">${n.type || "공지"}</td>
          <td class="notice-title">${n.title}</td>
          <td class="notice-date">${n.date}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // ====== 모달 관련 ======
    const modal = document.getElementById("noticeModal");
    const modalTitle = document.getElementById("modal-title");
    const modalType = document.getElementById("modal-type");
    const modalDate = document.getElementById("modal-date");
    const modalContent = document.getElementById("modal-content");
    const modalLink = document.getElementById("modal-link");
    const modalCloseBtn = document.getElementById("modal-close-btn");

    function openModalByIndex(idx){
      const n = NOTICES[idx];
      if(!n) return;

      modalTitle.textContent = n.title || "";
      modalType.textContent = n.type || "공지";
      modalDate.textContent = n.date || "";
      modalContent.textContent = n.content || "상세 내용이 별도로 등록되어 있지 않습니다.";

      if(n.url){
        modalLink.style.display = "inline-flex";
        modalLink.href = n.url;
      }else{
        modalLink.style.display = "none";
      }

      modal.classList.add("is-open");
      document.body.style.overflow = "hidden";
    }

    function closeModal(){
      modal.classList.remove("is-open");
      document.body.style.overflow = "";
    }

    // ✅ 이벤트 위임: tbody에 한 번만 리스너 등록 (여러 번 클릭해도 잘 동작)
    document.addEventListener("DOMContentLoaded", ()=>{
      loadNotices();

      const tbody = document.getElementById("notice-tbody");
      tbody.addEventListener("click", (e)=>{
        const tr = e.target.closest(".notice-row");
        if(!tr) return;
        const idx = tr.dataset.index;
        openModalByIndex(idx);
      });

      // 모달 닫기 이벤트
      modalCloseBtn.addEventListener("click", closeModal);
      modal.querySelector(".modal-overlay").addEventListener("click", closeModal);
      document.addEventListener("keydown", (e)=>{
        if(e.key === "Escape" && modal.classList.contains("is-open")){
          closeModal();
        }
      });
    });
  </script>
</body>
</html>
