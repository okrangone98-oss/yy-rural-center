<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>공지사항 | 양양군 농촌활성화지원센터</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family:"Noto Sans KR",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      line-height:1.6;
      color:#222;
      background:#f5f5f5;
    }
    a{text-decoration:none;color:inherit;}

    header{
      position:sticky;
      top:0;
      z-index:10;
      background:#ffffffcc;
      backdrop-filter:blur(8px);
      border-bottom:1px solid #e5e5e5;
    }
    .container{
      width:100%;
      max-width:1080px;
      margin:0 auto;
      padding:0 16px;
    }
    .nav{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 0;
    }
    .logo{font-weight:700;font-size:1.1rem;}
    .logo span{color:#0b7c5b;}
    .nav-links{
      display:flex;
      gap:16px;
      font-size:0.95rem;
    }
    .nav-links a{padding:4px 8px;border-radius:999px;}
    .nav-links a:hover{background:#0b7c5b;color:#fff;}

    main{padding:48px 0;}
    .page-title{font-size:1.8rem;font-weight:700;margin-bottom:8px;}
    .page-sub{font-size:0.95rem;color:#555;margin-bottom:24px;}

    .notice-wrapper{
      background:#fff;
      border-radius:16px;
      border:1px solid #e5e5e5;
      padding:16px 18px;
      box-shadow:0 6px 18px rgba(0,0,0,.03);
    }
    .notice-table{
      width:100%;
      border-collapse:collapse;
      font-size:0.9rem;
    }
    .notice-table thead{background:#f5f7f6;}
    .notice-table th,
    .notice-table td{
      padding:10px 8px;
      border-bottom:1px solid #ececec;
      text-align:left;
    }
    .notice-table tbody tr:hover{background:#f4fbf7;}
    .notice-type{
      font-size:0.8rem;
      color:#0b7c5b;
      font-weight:600;
      white-space:nowrap;
    }
    .notice-title a{color:#222;}
    .notice-title a:hover{text-decoration:underline;}
    .notice-date{
      font-size:0.8rem;
      color:#777;
      white-space:nowrap;
    }
    .notice-empty{
      text-align:center;
      color:#888;
      padding:18px 0;
      font-size:.85rem;
    }

    footer{
      padding:16px 0 24px;
      background:#111;
      color:#aaa;
      font-size:0.8rem;
      margin-top:40px;
    }
    footer .container{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    footer a{color:#e0f2e9;}

    @media (max-width:768px){
      .nav-links{display:none;}
      main{padding:32px 0;}
    }
  </style>
</head>
<body>
<header>
  <div class="container nav">
    <div class="logo">
      양양군 <span>농촌활성화지원센터</span>
    </div>
    <nav class="nav-links">
      <a href="index.html#about">센터소개</a>
      <a href="index.html#programs">주요사업</a>
      <a href="index.html#teachers">강사진</a>
      <a href="notice.html">공지사항</a>
      <a href="index.html#gallery">활동사진</a>
      <a href="index.html#contact">오시는길</a>
      <a href="qna.html">Q&A</a>
      <a href="admin.html">관리자</a>
    </nav>
  </div>
</header>

<main>
  <div class="container">
    <h1 class="page-title">공지사항</h1>
    <p class="page-sub">
      센터의 주요 공지, 모집 안내, 일정 변경 등의 내용을 한 눈에 보실 수 있습니다.
      각 제목을 클릭하면 상세 페이지(블로그 글, PDF 등)로 이동합니다.
    </p>

    <div class="notice-wrapper">
      <table class="notice-table">
        <thead>
          <tr>
            <th style="width:80px;">구분</th>
            <th>제목</th>
            <th style="width:120px;">날짜</th>
          </tr>
        </thead>
        <tbody id="notice-tbody">
        </tbody>
      </table>
    </div>
  </div>
</main>

<footer>
  <div class="container">
    <div>© <span id="year"></span> 양양군 농촌활성화지원센터. All rights reserved.</div>
  </div>
</footer>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();

  const NOTICE_CSV_URL =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vTO3geLtt5vZ-bOZiY4vb_Rd48xcQGJyZbmjXcHA1ZDnDmFQWAysgxvD-EumgkalVDlmRgdHfzqIVwf/pub?gid=1610639191&single=true&output=csv";

  function parseCSV(text){
    const rows=[];let row=[];let field="";let insideQuotes=false;
    for(let i=0;i<text.length;i++){
      const c=text[i];
      if(c === '"'){
        if(insideQuotes && text[i+1] === '"'){field+='"';i++;}
        else{insideQuotes=!insideQuotes;}
      }else if(c === "," && !insideQuotes){
        row.push(field);field="";
      }else if((c === "\n" || c === "\r") && !insideQuotes){
        if(field!=="" || row.length>0){row.push(field);rows.push(row);row=[];field="";}
      }else{
        field+=c;
      }
    }
    if(field!=="" || row.length>0){row.push(field);rows.push(row);}
    return rows;
  }

  async function loadNotices(){
    try{
      const res  = await fetch(NOTICE_CSV_URL);
      const text = await res.text();
      const rows = parseCSV(text);
      if(!rows.length) return;

      const headers  = rows[0].map(h=>h.trim());
      const dataRows = rows.slice(1);

      const colIndex = {
        type:  headers.findIndex(h=>h.includes("구분") || h.includes("분류") || h.toLowerCase().includes("type")),
        title: headers.findIndex(h=>h.includes("제목") || h.toLowerCase().includes("title")),
        date:  headers.findIndex(h=>h.includes("날짜") || h.includes("등록일") || h.toLowerCase().includes("date")),
        url:   headers.findIndex(h=>h.toLowerCase().includes("url") || h.includes("링크")),
      };

      const notices = dataRows
        .filter(r=>r[colIndex.title] && r[colIndex.title].trim() !== "")
        .map(r=>({
          type:  colIndex.type>=0 ? (r[colIndex.type]  || "").trim() : "공지",
          title: (r[colIndex.title]|| "").trim(),
          date:  colIndex.date>=0 ? (r[colIndex.date]  || "").trim() : "",
          url:   colIndex.url>=0  ? (r[colIndex.url]   || "").trim() : "",
        }));

      renderNoticeTable(notices);
    }catch(err){
      console.error("공지사항 로딩 오류:", err);
      const tbody = document.getElementById("notice-tbody");
      tbody.innerHTML = `
        <tr><td colspan="3" class="notice-empty">
          공지사항을 불러오지 못했습니다. 잠시 후 다시 시도해 주세요.
        </td></tr>
      `;
    }
  }

  function renderNoticeTable(list){
    const tbody = document.getElementById("notice-tbody");
    if(!tbody) return;

    if(!list.length){
      tbody.innerHTML = `
        <tr><td colspan="3" class="notice-empty">
          등록된 공지사항이 없습니다.
        </td></tr>
      `;
      return;
    }

    tbody.innerHTML = "";
    list.forEach(n=>{
      const tr      = document.createElement("tr");
      const typeTd  = document.createElement("td");
      const titleTd = document.createElement("td");
      const dateTd  = document.createElement("td");

      typeTd.className  = "notice-type";
      typeTd.textContent = n.type || "공지";

      titleTd.className = "notice-title";
      if(n.url){
        const a = document.createElement("a");
        a.href = n.url;
        a.target = "_blank";
        a.rel   = "noopener noreferrer";
        a.textContent = n.title;
        titleTd.appendChild(a);
      }else{
        titleTd.textContent = n.title;
      }

      dateTd.className  = "notice-date";
      dateTd.textContent = n.date;

      tr.appendChild(typeTd);
      tr.appendChild(titleTd);
      tr.appendChild(dateTd);
      tbody.appendChild(tr);
    });
  }

  document.addEventListener("DOMContentLoaded",loadNotices);
</script>
</body>
</html>
